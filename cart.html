<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Cart - Trendy Corner</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-white text-black">
  <header class="sticky top-0 bg-white border-b p-4">
    <div class="container mx-auto">Trendy Corner â€” Cart</div>
  </header>

  <main class="container mx-auto p-6">
    <section id="cartWrap" class="space-y-4">
      <div id="emptyState" class="text-center text-gray-600 hidden">
        Your cart is empty.
      </div>

      <div id="itemsList" class="space-y-4"></div>

      <div id="summary" class="hidden border-t pt-4">
        <div class="flex justify-between mb-3">
          <span class="font-medium">Subtotal</span>
          <span id="subtotal" class="font-medium">0</span>
        </div>

        <form id="orderForm" class="space-y-3">
          <input id="custName" type="text" placeholder="Your name" class="w-full border rounded px-3 py-2" />
          <input id="custPhone" type="tel" placeholder="Phone (for WhatsApp)" class="w-full border rounded px-3 py-2" />
          <textarea id="custAddress" rows="2" placeholder="Delivery address" class="w-full border rounded px-3 py-2"></textarea>

          <!-- Payment method -->
          <div class="pt-2">
            <div class="text-sm font-medium mb-2">Payment method</div>
            <label class="inline-flex items-center mr-4">
              <input type="radio" name="payment" value="Cash on Delivery" checked class="form-radio h-4 w-4 text-green-600">
              <span class="ml-2">Cash on Delivery</span>
            </label>
            <label class="inline-flex items-center">
              <input type="radio" name="payment" value="Online Payment" class="form-radio h-4 w-4 text-green-600">
              <span class="ml-2">Online Payment</span>
            </label>
          </div>

          <div class="flex gap-3">
            <button id="placeOrder" type="button" class="bg-green-600 text-white px-4 py-2 rounded">Place order (WhatsApp)</button>
            <button id="clearCart" type="button" class="bg-gray-200 px-4 py-2 rounded">Clear cart</button>
          </div>
        </form>
      </div>
    </section>
  </main>

  <script>
    (function () {
      const STORAGE_KEY = 'cart';
      const PHONE_NUMBER = 'PHONE_NUMBER'; // replace with your number in international format without + or spaces, e.g. 923001234567
      const itemsList = document.getElementById('itemsList');
      const emptyState = document.getElementById('emptyState');
      const summaryEl = document.getElementById('summary');
      const subtotalEl = document.getElementById('subtotal');
      const placeBtn = document.getElementById('placeOrder');
      const clearBtn = document.getElementById('clearCart');

      function readCart() {
        try {
          return JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]');
        } catch (e) {
          return [];
        }
      }
      function writeCart(cart) {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(cart));
        render();
      }

      function formatCurrency(n) {
        return 'Rs ' + (Number(n) || 0).toFixed(0);
      }

      function render() {
        const cart = readCart();
        itemsList.innerHTML = '';
        if (!cart.length) {
          emptyState.classList.remove('hidden');
          summaryEl.classList.add('hidden');
          return;
        }
        emptyState.classList.add('hidden');
        summaryEl.classList.remove('hidden');

        let subtotal = 0;
        cart.forEach((it, idx) => {
          const price = Number(it.price || 0);
          const qty = Number(it.qty || 1);
          subtotal += price * qty;

          const item = document.createElement('div');
          item.className = 'flex items-center justify-between border rounded p-3';
          item.innerHTML = `
            <div class="flex items-center gap-4">
              <img src="${it.image || 'logo.png'}" alt="" class="h-16 w-16 object-cover rounded">
              <div>
                <div class="font-medium">${escapeHtml(it.name || 'Item')}</div>
                <div class="text-sm text-gray-500">${formatCurrency(price)}</div>
              </div>
            </div>
            <div class="flex items-center gap-3">
              <input data-idx="${idx}" type="number" min="1" value="${qty}" class="w-16 border rounded px-2 py-1 qty" />
              <button data-idx="${idx}" class="remove text-sm text-red-600">Remove</button>
            </div>
          `;
          itemsList.appendChild(item);
        });

        subtotalEl.textContent = formatCurrency(subtotal);

        // attach listeners
        document.querySelectorAll('.qty').forEach(q => {
          q.addEventListener('change', (e) => {
            const i = Number(e.target.getAttribute('data-idx'));
            const val = Math.max(1, Number(e.target.value) || 1);
            const cart = readCart();
            if (cart[i]) {
              cart[i].qty = val;
              writeCart(cart);
            }
          });
        });
        document.querySelectorAll('.remove').forEach(btn => {
          btn.addEventListener('click', (e) => {
            const i = Number(e.target.getAttribute('data-idx'));
            const cart = readCart();
            cart.splice(i, 1);
            writeCart(cart);
          });
        });
      }

      // Place order -> build message and open WhatsApp
      placeBtn.addEventListener('click', () => {
        const name = document.getElementById('custName').value.trim();
        const phone = document.getElementById('custPhone').value.trim();
        const address = document.getElementById('custAddress').value.trim();
        const payment = document.querySelector('input[name="payment"]:checked')?.value || 'Cash on Delivery';
        const cart = readCart();
        if (!cart.length) {
          alert('Cart is empty.');
          return;
        }
        if (!name || !phone || !address) {
          alert('Please enter name, phone and delivery address.');
          return;
        }

        let total = 0;
        const lines = cart.map(it => {
          const price = Number(it.price || 0);
          const qty = Number(it.qty || 1);
          total += price * qty;
          return `${it.name} x${qty} - Rs ${price * qty}`;
        });

        const msg =
`New order from Trendy Corner
Name: ${name}
Phone: ${phone}
Address: ${address}
Payment method: ${payment}
Items:
${lines.join('\n')}
Total: Rs ${total}
`;

        const encoded = encodeURIComponent(msg);
        // If PHONE_NUMBER is not set, open generic wa.me with text only.
        const waUrl = PHONE_NUMBER && PHONE_NUMBER !== 'PHONE_NUMBER'
          ? `https://wa.me/${PHONE_NUMBER}?text=${encoded}`
          : `https://wa.me/?text=${encoded}`;

        // open whatsapp
        window.open(waUrl, '_blank');

        // clear cart and show simple confirmation
        localStorage.removeItem(STORAGE_KEY);
        alert('Order prepared and WhatsApp opened. Cart cleared.');
        render();
      });

      clearBtn.addEventListener('click', () => {
        if (!confirm('Clear cart?')) return;
        localStorage.removeItem(STORAGE_KEY);
        render();
      });

      // small helper to escape inserted text into DOM (prevent basic injection)
      function escapeHtml(s) {
        return String(s)
          .replace(/&/g, '&amp;')
          .replace(/</g, '&lt;')
          .replace(/>/g, '&gt;')
          .replace(/"/g, '&quot;')
          .replace(/'/g, '&#39;');
      }

      // initial render
      render();

      // Expose helper to global so other pages can add items:
      window.TrendyCart = {
        add(item) {
          // item: {id,name,price,qty,image}
          const cart = readCart();
          const exist = cart.find(c => c.id === item.id);
          if (exist) {
            exist.qty = (exist.qty || 0) + (item.qty || 1);
          } else {
            cart.push(Object.assign({qty:1}, item));
          }
          writeCart(cart);
        },
        get() { return readCart(); },
        clear() { localStorage.removeItem(STORAGE_KEY); render(); }
      };
    })();
  </script>
</body>
</html>