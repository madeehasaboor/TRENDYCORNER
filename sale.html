<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sale - Trendy Corner | Elegant Fashion & Style</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;500;600;700&family=Inter:wght@300;400;500;600;700&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
        }
        
        .font-elegant {
            font-family: 'Playfair Display', serif;
        }
        
        .product-card {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }
        
        .filter-sidebar {
            transition: transform 0.3s ease;
        }
        
        .discount-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #000;
            color: #fff;
            padding: 5px 10px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .size-option {
            border: 1px solid #e5e7eb;
            padding: 8px 12px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .size-option:hover {
            border-color: #000;
        }
        
        .size-option.selected {
            border-color: #000;
            background: #000;
            color: #fff;
        }
        
        .cart-sidebar {
            transform: translateX(100%);
            transition: transform 0.3s ease;
        }
        
        .cart-sidebar.open {
            transform: translateX(0);
        }
        
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }
        
        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .modal-content {
            background-color: #fff;
            padding: 2rem;
            border-radius: 8px;
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }
    </style>
</head>
<body class="bg-white text-black">
    <!-- Navigation Header -->
    <header class="sticky top-0 z-50 bg-white border-b border-gray-200 shadow-sm">
        <nav class="container mx-auto px-4 py-4">
            <div class="flex items-center justify-between">
                <!-- Logo -->
                <div class="flex items-center space-x-2">
                    <a href="index.html" class="font-elegant text-2xl font-bold text-black">Trendy Corner</a>
                </div>
                
                <!-- Desktop Navigation -->
                <div class="hidden lg:flex items-center space-x-6">
                    <a href="index.html#home" class="text-black font-medium hover:text-gray-700">Home</a>
                    <a href="sale.html" class="text-black font-medium hover:text-gray-700">Sale</a>
                    <div class="relative group">
                        <button class="text-black font-medium hover:text-gray-700 flex items-center gap-2">
                            Summers
                            <i class="fas fa-chevron-down text-xs"></i>
                        </button>
                        <div class="absolute top-full left-0 mt-2 w-60 bg-white shadow-lg border border-gray-200 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 z-20">
                            <a href="category.html?name=Nishat" class="block px-4 py-2 hover:bg-gray-100">Nishat</a>
                            <a href="category.html?name=Crimson" class="block px-4 py-2 hover:bg-gray-100">Crimson</a>
                            <a href="category.html?name=Sana%20Safinaz" class="block px-4 py-2 hover:bg-gray-100">Sana Safinaz</a>
                            <a href="category.html?name=Bareeze" class="block px-4 py-2 hover:bg-gray-100">Bareeze</a>
                            <a href="category.html?name=Zara%20Shahjahan" class="block px-4 py-2 hover:bg-gray-100">Zara Shahjahan</a>
                            <a href="category.html?name=Sapphire" class="block px-4 py-2 hover:bg-gray-100">Sapphire</a>
                            <a href="category.html?name=Mushq" class="block px-4 py-2 hover:bg-gray-100">Mushq</a>
                            <a href="category.html?name=Maria%20B" class="block px-4 py-2 hover:bg-gray-100">Maria B</a>
                            <a href="category.html?name=Asifa%20Nabeel" class="block px-4 py-2 hover:bg-gray-100">Asifa Nabeel</a>
                            <a href="category.html?name=Alif" class="block px-4 py-2 hover:bg-gray-100">Alif</a>
                            <a href="category.html?name=Noor%20by%20Sadia%20Asad" class="block px-4 py-2 hover:bg-gray-100">Noor by Sadia Asad</a>
                            <a href="category.html?name=Suffuse" class="block px-4 py-2 hover:bg-gray-100">Suffuse</a>
                            <a href="category.html?name=Afrozeh" class="block px-4 py-2 hover:bg-gray-100">Afrozeh</a>
                            <a href="category.html?name=Mix%20Brands" class="block px-4 py-2 hover:bg-gray-100">Mix Brands</a>
                        </div>
                    </div>
                    <div class="relative group">
                        <button class="text-black font-medium hover:text-gray-700 flex items-center gap-2">
                            Winters
                            <i class="fas fa-chevron-down text-xs"></i>
                        </button>
                        <div class="absolute top-full left-0 mt-2 w-60 bg-white shadow-lg border border-gray-200 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 z-20">
                            <a href="category.html?name=Pure%20Pashmina" class="block px-4 py-2 hover:bg-gray-100">Pure Pashmina</a>
                            <a href="category.html?name=Pashmina%20kani" class="block px-4 py-2 hover:bg-gray-100">Pashmina kani</a>
                            <a href="category.html?name=Shawls" class="block px-4 py-2 hover:bg-gray-100">Shawls</a>
                            <a href="category.html?name=Kami%20Silk%20Shawls" class="block px-4 py-2 hover:bg-gray-100">Kami Silk Shawls</a>
                        </div>
                    </div>
                    <a href="category.html?name=Mix%20Brands" class="text-black font-medium hover:text-gray-700">Mix Brands</a>
                </div>
                
                <!-- Icons -->
                <div class="flex items-center space-x-4">
                    <button id="searchBtn" class="text-black hover:text-gray-700 transition-colors">
                        <i class="fas fa-search text-xl"></i>
                    </button>
                    <button id="wishlistBtn" class="text-black hover:text-gray-700 transition-colors relative">
                        <i class="fas fa-heart text-xl"></i>
                        <span id="wishlistCount" class="absolute -top-2 -right-2 bg-black text-white text-xs rounded-full w-5 h-5 flex items-center justify-center hidden">0</span>
                    </button>
                    <a id="cartBtn" href="cart.html" class="text-black hover:text-gray-700 transition-colors relative" aria-label="Cart">
                        <i class="fas fa-shopping-bag text-xl"></i>
                        <span id="cartCount" class="absolute -top-2 -right-2 bg-black text-white text-xs rounded-full w-5 h-5 flex items-center justify-center">0</span>
                    </a>
                    <button id="userBtn" class="text-black hover:text-gray-700 transition-colors">
                        <i class="fas fa-user text-xl"></i>
                    </button>
                    <button id="mobileMenuBtn" class="lg:hidden text-black">
                        <i class="fas fa-bars text-xl"></i>
                    </button>
                </div>
            </div>
        </nav>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto px-4 py-8">
        <!-- Breadcrumb -->
        <div class="mb-6 text-sm text-gray-600">
            <a href="index.html" class="hover:text-black">Home</a> / <span class="text-black">Sale</span>
        </div>

        <!-- Page Header -->
        <div class="mb-8">
            <h1 class="font-elegant text-4xl font-bold mb-2">SALE</h1>
            <p class="text-gray-600" id="resultsCount">1643 results</p>
        </div>

        <div class="flex flex-col lg:flex-row gap-8">
            <!-- Filter Sidebar -->
            <aside class="lg:w-64 flex-shrink-0">
                <div class="bg-white border border-gray-200 p-6 sticky top-24">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="font-semibold text-lg">Refined by</h2>
                        <button id="clearFilters" class="text-sm text-gray-600 hover:text-black">Clear all</button>
                    </div>

                    <!-- Price Filter -->
                    <div class="mb-6 pb-6 border-b border-gray-200">
                        <h3 class="font-semibold mb-4">Price</h3>
                        <div class="space-y-2">
                            <div class="flex items-center gap-2">
                                <input type="number" id="minPrice" placeholder="Min" class="w-20 px-2 py-1 border border-gray-300 rounded text-sm">
                                <span>to</span>
                                <input type="number" id="maxPrice" placeholder="Max" class="w-20 px-2 py-1 border border-gray-300 rounded text-sm">
                            </div>
                        </div>
                    </div>

                    <!-- Size Filter -->
                    <div class="mb-6 pb-6 border-b border-gray-200">
                        <h3 class="font-semibold mb-4">Size</h3>
                        <div class="flex flex-wrap gap-2">
                            <label class="size-option cursor-pointer">
                                <input type="checkbox" value="XS" class="hidden size-checkbox">
                                <span>XS</span>
                            </label>
                            <label class="size-option cursor-pointer">
                                <input type="checkbox" value="S" class="hidden size-checkbox">
                                <span>S</span>
                            </label>
                            <label class="size-option cursor-pointer">
                                <input type="checkbox" value="M" class="hidden size-checkbox">
                                <span>M</span>
                            </label>
                            <label class="size-option cursor-pointer">
                                <input type="checkbox" value="L" class="hidden size-checkbox">
                                <span>L</span>
                            </label>
                            <label class="size-option cursor-pointer">
                                <input type="checkbox" value="XL" class="hidden size-checkbox">
                                <span>XL</span>
                            </label>
                        </div>
                    </div>

                    <!-- Cut Filter -->
                    <div class="mb-6 pb-6 border-b border-gray-200">
                        <h3 class="font-semibold mb-4">Cut</h3>
                        <div class="space-y-2">
                            <label class="flex items-center">
                                <input type="checkbox" value="basic" class="mr-2 cut-checkbox">
                                <span class="text-sm">Basic (10)</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" value="culotte" class="mr-2 cut-checkbox">
                                <span class="text-sm">Culotte (11)</span>
                            </label>
                        </div>
                    </div>

                    <!-- Fabric Filter -->
                    <div class="mb-6 pb-6 border-b border-gray-200">
                        <h3 class="font-semibold mb-4">Fabric</h3>
                        <div class="space-y-2">
                            <label class="flex items-center">
                                <input type="checkbox" value="linen" class="mr-2 fabric-checkbox">
                                <span class="text-sm">Linen (17)</span>
                            </label>
                        </div>
                    </div>

                    <!-- Piece Filter -->
                    <div class="mb-6 pb-6 border-b border-gray-200">
                        <h3 class="font-semibold mb-4">Piece</h3>
                        <div class="space-y-2">
                            <label class="flex items-center">
                                <input type="checkbox" value="1-pc" class="mr-2 piece-checkbox">
                                <span class="text-sm">1-pc (64)</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" value="3-piece" class="mr-2 piece-checkbox">
                                <span class="text-sm">3-piece (14)</span>
                            </label>
                        </div>
                    </div>

                    <!-- Season Filter -->
                    <div class="mb-6">
                        <h3 class="font-semibold mb-4">Season</h3>
                        <div class="space-y-2">
                            <label class="flex items-center">
                                <input type="checkbox" value="fall-winter-22" class="mr-2 season-checkbox">
                                <span class="text-sm">Fall Winter 22 (128)</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" value="spring-summer" class="mr-2 season-checkbox">
                                <span class="text-sm">Spring Summer (90)</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" value="spring-summer-23" class="mr-2 season-checkbox">
                                <span class="text-sm">Spring Summer 23 (64)</span>
                            </label>
                        </div>
                    </div>
                </div>
            </aside>

            <!-- Products Section -->
            <div class="flex-1">
                <!-- Sort and View Options -->
                <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6 gap-4">
                    <div class="flex items-center gap-4">
                        <button id="gridView" class="p-2 border border-gray-300 hover:border-black">
                            <i class="fas fa-th"></i>
                        </button>
                        <button id="listView" class="p-2 border border-gray-300 hover:border-black">
                            <i class="fas fa-list"></i>
                        </button>
                    </div>
                    <div class="flex items-center gap-4">
                        <label class="text-sm">Sort by:</label>
                        <select id="sortBy" class="border border-gray-300 px-4 py-2 rounded">
                            <option value="newest">Newest</option>
                            <option value="price-low">Price: Low to High</option>
                            <option value="price-high">Price: High to Low</option>
                            <option value="name">Name A-Z</option>
                        </select>
                    </div>
                </div>

                <!-- Products Grid -->
                <div id="productsGrid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 mb-8">
                    <!-- Products will be loaded here -->
                </div>

                <!-- Pagination -->
                <div class="flex justify-center items-center gap-2 mb-8">
                    <button class="px-4 py-2 border border-gray-300 hover:border-black disabled:opacity-50" id="prevPage" disabled>Previous</button>
                    <div id="paginationNumbers" class="flex gap-2">
                        <!-- Pagination numbers will be generated here -->
                    </div>
                    <button class="px-4 py-2 border border-gray-300 hover:border-black" id="nextPage">Next</button>
                </div>
            </div>
        </div>
    </main>

    <!-- Shopping Cart Sidebar -->
    <div id="cartSidebar" class="cart-sidebar fixed top-0 right-0 h-full w-full sm:w-96 bg-white shadow-2xl z-50 overflow-y-auto">
        <div class="p-6">
            <div class="flex justify-between items-center mb-6">
                <h2 class="font-elegant text-2xl font-bold">Shopping Cart</h2>
                <button id="closeCart" class="text-2xl hover:text-gray-600">&times;</button>
            </div>
            <div id="cartItems" class="space-y-4">
                <!-- Cart items will be loaded here -->
                <p class="text-gray-500 text-center py-8">Your cart is empty</p>
            </div>
            <div class="mt-8 pt-6 border-t border-gray-200">
                <div class="flex justify-between mb-4">
                    <span class="font-semibold">Total:</span>
                    <span class="font-bold text-xl" id="cartTotal">Rs. 0</span>
                </div>
                <button class="w-full bg-black text-white py-3 font-semibold hover:bg-gray-800 transition-colors">
                    Checkout
                </button>
            </div>
        </div>
    </div>

    <!-- Search Modal -->
    <div id="searchModal" class="modal">
        <div class="modal-content">
            <div class="flex justify-between items-center mb-4">
                <h2 class="font-elegant text-2xl font-bold">Search</h2>
                <button id="closeSearch" class="text-2xl hover:text-gray-600">&times;</button>
            </div>
            <input type="text" id="searchInput" placeholder="Search products..." class="w-full px-4 py-3 border border-gray-300 rounded mb-4">
            <div id="searchResults" class="space-y-2">
                <!-- Search results will appear here -->
            </div>
        </div>
    </div>

    <!-- Login Modal -->
    <div id="loginModal" class="modal">
        <div class="modal-content">
            <div class="flex justify-between items-center mb-4">
                <h2 class="font-elegant text-2xl font-bold">Login</h2>
                <button id="closeLogin" class="text-2xl hover:text-gray-600">&times;</button>
            </div>
            <form id="loginForm" class="space-y-4">
                <div>
                    <label class="block text-sm font-medium mb-2">Email Address *</label>
                    <input type="email" required class="w-full px-4 py-2 border border-gray-300 rounded">
                </div>
                <div>
                    <label class="block text-sm font-medium mb-2">Password *</label>
                    <input type="password" required class="w-full px-4 py-2 border border-gray-300 rounded">
                </div>
                <div class="flex items-center justify-between">
                    <label class="flex items-center">
                        <input type="checkbox" class="mr-2">
                        <span class="text-sm">Remember me</span>
                    </label>
                    <a href="#" class="text-sm text-gray-600 hover:text-black">Forgot password?</a>
                </div>
                <button type="submit" class="w-full bg-black text-white py-3 font-semibold hover:bg-gray-800 transition-colors">
                    Login
                </button>
                <p class="text-center text-sm">
                    Don't have an account? <a href="#" class="text-black font-semibold">Create account</a>
                </p>
            </form>
        </div>
    </div>

    <!-- Quick Add Modal -->
    <div id="quickAddModal" class="modal">
        <div class="modal-content">
            <div class="flex justify-between items-center mb-4">
                <h2 class="font-elegant text-xl font-bold" id="quickAddTitle">Add to Cart</h2>
                <button id="closeQuickAdd" class="text-2xl hover:text-gray-600">&times;</button>
            </div>
            <div id="quickAddContent">
                <!-- Quick add content will be loaded here -->
            </div>
        </div>
    </div>

    <script>
        const API_BASE_URL = 'http://localhost:5000/api';
        
        let products = [];
        let allProducts = [];
        let cart = JSON.parse(localStorage.getItem('cart')) || [];
        let wishlist = JSON.parse(localStorage.getItem('wishlist')) || [];
        let currentPage = 1;
        let itemsPerPage = 50;
        let currentView = 'grid';
        let totalProducts = 0;
        let currentFilters = {};

        // Initialize
        async function init() {
            await loadProducts();
            updateCartCount();
            updateWishlistCount();
            setupEventListeners();
            applyFilters();
        }

        // Load Products from API
        async function loadProducts() {
            try {
                const params = new URLSearchParams({
                    page: currentPage,
                    limit: itemsPerPage,
                    category: 'sale',
                    ...currentFilters
                });
                
                const response = await fetch(`${API_BASE_URL}/products?${params}`);
                const result = await response.json();
                
                allProducts = result.data || [];
                totalProducts = result.total || 0;
                
                // Transform API data to match frontend format
                products = allProducts.map(p => ({
                    id: p.id,
                    name: p.name,
                    code: p.id.toString(),
                    description: p.description || '',
                    price: parseFloat(p.price),
                    originalPrice: p.original_price ? parseFloat(p.original_price) : null,
                    discount: p.discount || (p.original_price ? Math.round(((p.original_price - p.price) / p.original_price) * 100) : 0),
                    image: p.image_url || 'https://via.placeholder.com/400x500',
                    sizes: p.size ? p.size.split(',').map(s => s.trim()) : [],
                    cut: p.cut || '',
                    fabric: p.fabric || '',
                    piece: p.piece || ''
                }));
                
                document.getElementById('resultsCount').textContent = `${totalProducts} results`;
                renderProducts();
            } catch (error) {
                console.error('Error loading products:', error);
                // Fallback to sample data if API fails
                products = getSampleProducts();
                renderProducts();
            }
        }

        // Sample products fallback
        function getSampleProducts() {
            return [
                {
                    id: 1,
                    name: "Stitched Signature Shirt + Bottom",
                    code: "SS25SGE438P2T",
                    description: "One silhouette, endless moments made to move with you, day to night.",
                    price: 9750,
                    originalPrice: 19499,
                    discount: 50,
                    image: "https://via.placeholder.com/400x500",
                    sizes: ["XS", "S", "M", "L"],
                    cut: "Basic",
                    fabric: "Cotton",
                    piece: "2-piece"
                },
                {
                    id: 2,
                    name: "Stitched Kids Linen Shirt",
                    code: "SS25GBSP127",
                    description: "A soft, breathable shirt, featuring a playful print.",
                    price: 2150,
                    originalPrice: 4299,
                    discount: 50,
                    image: "https://via.placeholder.com/400x500",
                    sizes: ["7", "8", "10", "12", "14"],
                    fabric: "Linen",
                    cut: "Raglan",
                    piece: "1-pc"
                }
            ];
        }

        // Render Products
        function renderProducts() {
            const grid = document.getElementById('productsGrid');
            const pageProducts = products;

            grid.className = currentView === 'grid' 
                ? 'grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 mb-8'
                : 'grid grid-cols-1 gap-6 mb-8';

            if (pageProducts.length === 0) {
                grid.innerHTML = '<div class="col-span-full text-center py-12"><p class="text-gray-500">No products found</p></div>';
                return;
            }

            grid.innerHTML = pageProducts.map(product => `
                <div class="product-card bg-white border border-gray-200 ${currentView === 'list' ? 'flex gap-4' : ''}">
                    <div class="relative ${currentView === 'list' ? 'w-48 flex-shrink-0' : ''}">
                        <div class="aspect-square bg-gray-100 ${currentView === 'list' ? 'h-full' : ''}">
                            <img src="${product.image}" alt="${product.name}" class="w-full h-full object-cover">
                        </div>
                        ${product.discount ? `<div class="discount-badge">-${product.discount}%</div>` : ''}
                        <button onclick="toggleWishlist(${product.id})" class="absolute top-2 left-2 p-2 bg-white rounded-full shadow hover:bg-gray-100">
                            <i class="fas fa-heart ${wishlist.includes(product.id) ? 'text-red-500' : 'text-gray-400'}"></i>
                        </button>
                    </div>
                    <div class="p-4 flex-1">
                        <h3 class="font-semibold text-black mb-2">${product.name}</h3>
                        <p class="text-xs text-gray-500 mb-2">${product.code}</p>
                        ${product.description ? `<p class="text-sm text-gray-600 mb-3 line-clamp-2">${product.description}</p>` : ''}
                        <div class="flex items-center gap-2 mb-3">
                            <span class="font-bold text-lg">Rs. ${product.price.toLocaleString()}</span>
                            ${product.originalPrice ? `<span class="text-gray-400 line-through text-sm">Rs. ${product.originalPrice.toLocaleString()}</span>` : ''}
                        </div>
                        <button onclick="openQuickAdd(${product.id})" class="w-full bg-black text-white py-2 font-semibold hover:bg-gray-800 transition-colors">
                            Quick add
                        </button>
                    </div>
                </div>
            `).join('');

            renderPagination();
        }

        // Render Pagination
        function renderPagination() {
            const totalPages = Math.ceil(totalProducts / itemsPerPage);
            const paginationNumbers = document.getElementById('paginationNumbers');
            const prevBtn = document.getElementById('prevPage');
            const nextBtn = document.getElementById('nextPage');

            prevBtn.disabled = currentPage === 1;
            nextBtn.disabled = currentPage >= totalPages;

            paginationNumbers.innerHTML = '';
            const maxPages = Math.min(totalPages, 10);
            for (let i = 1; i <= maxPages; i++) {
                const btn = document.createElement('button');
                btn.className = `px-4 py-2 border ${i === currentPage ? 'border-black bg-black text-white' : 'border-gray-300 hover:border-black'}`;
                btn.textContent = i;
                btn.onclick = async () => {
                    currentPage = i;
                    await loadProducts();
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                };
                paginationNumbers.appendChild(btn);
            }
        }

        // Apply Filters
        function applyFilters() {
            const filters = {};
            
            const minPrice = document.getElementById('minPrice').value;
            const maxPrice = document.getElementById('maxPrice').value;
            if (minPrice) filters.minPrice = minPrice;
            if (maxPrice) filters.maxPrice = maxPrice;
            
            const selectedSizes = Array.from(document.querySelectorAll('.size-checkbox:checked')).map(cb => cb.value);
            if (selectedSizes.length > 0) filters.sizes = selectedSizes;
            
            const selectedCut = Array.from(document.querySelectorAll('.cut-checkbox:checked')).map(cb => cb.value)[0];
            if (selectedCut) filters.cut = selectedCut;
            
            const selectedFabric = Array.from(document.querySelectorAll('.fabric-checkbox:checked')).map(cb => cb.value)[0];
            if (selectedFabric) filters.fabric = selectedFabric;
            
            const selectedPiece = Array.from(document.querySelectorAll('.piece-checkbox:checked')).map(cb => cb.value)[0];
            if (selectedPiece) filters.piece = selectedPiece;
            
            const selectedSeason = Array.from(document.querySelectorAll('.season-checkbox:checked')).map(cb => cb.value)[0];
            if (selectedSeason) filters.season = selectedSeason;
            
            const sortBy = document.getElementById('sortBy').value;
            if (sortBy) filters.sortBy = sortBy;
            
            currentFilters = filters;
            currentPage = 1;
            loadProducts();
        }

        // Cart Functions
        function addToCart(productId, size, quantity = 1) {
            const product = products.find(p => p.id === productId);
            if (!product) return;

            const cartItem = {
                id: Date.now(),
                productId,
                name: product.name,
                price: product.price,
                size,
                quantity,
                image: product.image
            };

            cart.push(cartItem);
            localStorage.setItem('cart', JSON.stringify(cart));
            updateCartCount();
            renderCart();
        }

        function updateCartCount() {
            const count = cart.reduce((sum, item) => sum + item.quantity, 0);
            document.getElementById('cartCount').textContent = count;
            document.getElementById('cartCount').classList.toggle('hidden', count === 0);
        }

        function renderCart() {
            const cartItems = document.getElementById('cartItems');
            if (cart.length === 0) {
                cartItems.innerHTML = '<p class="text-gray-500 text-center py-8">Your cart is empty</p>';
                document.getElementById('cartTotal').textContent = 'Rs. 0';
                return;
            }

            const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            document.getElementById('cartTotal').textContent = `Rs. ${total.toLocaleString()}`;

            cartItems.innerHTML = cart.map(item => `
                <div class="flex gap-4 border-b border-gray-200 pb-4">
                    <img src="${item.image}" alt="${item.name}" class="w-20 h-20 object-cover">
                    <div class="flex-1">
                        <h4 class="font-semibold text-sm">${item.name}</h4>
                        <p class="text-xs text-gray-500">Size: ${item.size}</p>
                        <p class="text-sm font-semibold mt-1">Rs. ${item.price.toLocaleString()}</p>
                        <div class="flex items-center gap-2 mt-2">
                            <button onclick="updateCartQuantity(${item.id}, -1)" class="px-2 py-1 border border-gray-300">-</button>
                            <span>${item.quantity}</span>
                            <button onclick="updateCartQuantity(${item.id}, 1)" class="px-2 py-1 border border-gray-300">+</button>
                            <button onclick="removeFromCart(${item.id})" class="ml-auto text-red-500 hover:text-red-700">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function updateCartQuantity(itemId, change) {
            const item = cart.find(i => i.id === itemId);
            if (item) {
                item.quantity += change;
                if (item.quantity <= 0) {
                    cart = cart.filter(i => i.id !== itemId);
                }
                localStorage.setItem('cart', JSON.stringify(cart));
                updateCartCount();
                renderCart();
            }
        }

        function removeFromCart(itemId) {
            cart = cart.filter(i => i.id !== itemId);
            localStorage.setItem('cart', JSON.stringify(cart));
            updateCartCount();
            renderCart();
        }

        // Wishlist Functions
        function toggleWishlist(productId) {
            if (wishlist.includes(productId)) {
                wishlist = wishlist.filter(id => id !== productId);
            } else {
                wishlist.push(productId);
            }
            localStorage.setItem('wishlist', JSON.stringify(wishlist));
            updateWishlistCount();
            renderProducts();
        }

        function updateWishlistCount() {
            const count = wishlist.length;
            document.getElementById('wishlistCount').textContent = count;
            document.getElementById('wishlistCount').classList.toggle('hidden', count === 0);
        }

        // Quick Add Modal
        function openQuickAdd(productId) {
            const product = allProducts.find(p => p.id === productId) || products.find(p => p.id === productId);
            if (!product) {
                alert('Product not found');
                return;
            }
            
            // Ensure product has sizes array
            const productSizes = product.sizes || (product.size ? product.size.split(',').map(s => s.trim()).filter(s => s) : []);
            quickAddQuantity = 1;

            document.getElementById('quickAddTitle').textContent = product.name;
            document.getElementById('quickAddContent').innerHTML = `
                <div class="mb-4">
                    <img src="${product.image}" alt="${product.name}" class="w-full h-64 object-cover mb-4">
                    <p class="text-sm text-gray-600 mb-4">${product.description || ''}</p>
                    <div class="flex items-center gap-2 mb-4">
                        <span class="font-bold text-lg">Rs. ${product.price.toLocaleString()}</span>
                        ${product.originalPrice ? `<span class="text-gray-400 line-through text-sm">Rs. ${product.originalPrice.toLocaleString()}</span>` : ''}
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium mb-2">Size:</label>
                        <div class="flex flex-wrap gap-2">
                            ${productSizes.length > 0 ? productSizes.map(size => `
                                <label class="size-option">
                                    <input type="radio" name="size" value="${size}" class="hidden size-radio">
                                    <span>${size}</span>
                                </label>
                            `).join('') : '<p class="text-sm text-gray-500">No sizes available</p>'}
                        </div>
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium mb-2">Quantity:</label>
                        <div class="flex items-center gap-2">
                            <button onclick="changeQuantity(-1)" class="px-3 py-1 border border-gray-300">-</button>
                            <span id="quantityDisplay" class="px-4">1</span>
                            <button onclick="changeQuantity(1)" class="px-3 py-1 border border-gray-300">+</button>
                        </div>
                    </div>
                    <button onclick="addSelectedToCart(${productId})" class="w-full bg-black text-white py-3 font-semibold hover:bg-gray-800 transition-colors">
                        Add to Cart
                    </button>
                </div>
            `;
            document.getElementById('quickAddModal').classList.add('active');
        }

        let quickAddQuantity = 1;
        function changeQuantity(change) {
            quickAddQuantity = Math.max(1, quickAddQuantity + change);
            document.getElementById('quantityDisplay').textContent = quickAddQuantity;
        }

        function addSelectedToCart(productId) {
            const selectedSize = document.querySelector('input[name="size"]:checked');
            const product = allProducts.find(p => p.id === productId) || products.find(p => p.id === productId);
            const productSizes = product?.sizes || (product?.size ? product.size.split(',').map(s => s.trim()).filter(s => s) : []);
            
            if (productSizes.length > 0 && !selectedSize) {
                alert('Please select a size');
                return;
            }
            
            const size = selectedSize ? selectedSize.value : 'Standard';
            addToCart(productId, size, quickAddQuantity);
            document.getElementById('quickAddModal').classList.remove('active');
            quickAddQuantity = 1;
        }

        // Event Listeners
        function setupEventListeners() {
            // Cart
            document.getElementById('cartBtn').addEventListener('click', () => {
                renderCart();
                document.getElementById('cartSidebar').classList.add('open');
            });
            document.getElementById('closeCart').addEventListener('click', () => {
                document.getElementById('cartSidebar').classList.remove('open');
            });

            // Search
            document.getElementById('searchBtn').addEventListener('click', () => {
                document.getElementById('searchModal').classList.add('active');
            });
            document.getElementById('closeSearch').addEventListener('click', () => {
                document.getElementById('searchModal').classList.remove('active');
            });

            // Login
            document.getElementById('userBtn').addEventListener('click', () => {
                document.getElementById('loginModal').classList.add('active');
            });
            document.getElementById('closeLogin').addEventListener('click', () => {
                document.getElementById('loginModal').classList.remove('active');
            });

            // Quick Add
            document.getElementById('closeQuickAdd').addEventListener('click', () => {
                document.getElementById('quickAddModal').classList.remove('active');
            });

            // View Toggle
            document.getElementById('gridView').addEventListener('click', () => {
                currentView = 'grid';
                renderProducts();
            });
            document.getElementById('listView').addEventListener('click', () => {
                currentView = 'list';
                renderProducts();
            });

            // Filter listeners
            document.getElementById('clearFilters').addEventListener('click', () => {
                document.getElementById('minPrice').value = '';
                document.getElementById('maxPrice').value = '';
                document.querySelectorAll('.size-checkbox, .cut-checkbox, .fabric-checkbox, .piece-checkbox, .season-checkbox').forEach(cb => cb.checked = false);
                currentFilters = {};
                applyFilters();
            });

            document.querySelectorAll('.size-checkbox, .cut-checkbox, .fabric-checkbox, .piece-checkbox, .season-checkbox').forEach(cb => {
                cb.addEventListener('change', applyFilters);
            });

            document.getElementById('minPrice').addEventListener('change', applyFilters);
            document.getElementById('maxPrice').addEventListener('change', applyFilters);
            document.getElementById('sortBy').addEventListener('change', applyFilters);

            // Pagination
            document.getElementById('prevPage').addEventListener('click', async () => {
                if (currentPage > 1) {
                    currentPage--;
                    await loadProducts();
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                }
            });

            document.getElementById('nextPage').addEventListener('click', async () => {
                const totalPages = Math.ceil(totalProducts / itemsPerPage);
                if (currentPage < totalPages) {
                    currentPage++;
                    await loadProducts();
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                }
            });

            // Close modals on outside click
            document.querySelectorAll('.modal').forEach(modal => {
                modal.addEventListener('click', (e) => {
                    if (e.target === modal) {
                        modal.classList.remove('active');
                    }
                });
            });
        }

        // Make functions global
        window.toggleWishlist = toggleWishlist;
        window.openQuickAdd = openQuickAdd;
        window.changeQuantity = changeQuantity;
        window.addSelectedToCart = addSelectedToCart;
        window.updateCartQuantity = updateCartQuantity;
        window.removeFromCart = removeFromCart;

        // Initialize on load
        init();
    </script>
</body>
</html>

